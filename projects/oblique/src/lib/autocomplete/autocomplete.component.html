<mat-form-field>
	<mat-icon svgIcon="search" matPrefix />
	@if (inputLabelKey?.length > 0) {
		<mat-label>{{ inputLabelKey | translate }}</mat-label>
	}
	<input
		(blur)="onModelTouched()"
		[formControl]="autocompleteInputControl"
		[matAutocomplete]="autocomplete"
		matInput
		type="text"
	/>
	@for (hint of hints(); track hint) {
		<mat-hint [align]="hint.align" [innerHTML]="hint.template" />
	}
	<ng-content select="[matPrefix]" />
	<button [obInputClear]="autocompleteInputControl" type="button">
		<mat-icon svgIcon="xmark_circle" />
		<span class="ob-screen-reader-only">{{ "i18n.common.clear" | translate }}</span>
	</button>
	<ng-content select="[matSuffix]" />
</mat-form-field>

<mat-autocomplete #autocomplete="matAutocomplete" [displayWith]="displayWith()" class="ob-autocomplete-panel">
	<ng-container
		*ngTemplateOutlet="hasGroupOptions ? optionGroups : onlyOptions; context: { $implicit: (filteredOptions$ | async) }"
	/>

	<ng-template #optionGroups let-options>
		@for (group of options; track group) {
			<mat-optgroup [disabled]="group['disabled']" [label]="group['groupLabel']">
				<ng-container
					*ngTemplateOutlet="
						group['groupOptions']?.length > 0 && hasGroupOptions ? onlyOptions : optionGroups;
						context: { $implicit: group['groupOptions'] }
					"
				/>
			</mat-optgroup>
		}
	</ng-template>

	<ng-template #onlyOptions let-options>
		@for (option of options; track option) {
			<mat-option
				(onSelectionChange)="selectedOptionChange.emit(option)"
				[value]="option.label"
				[disabled]="option.disabled"
			>
				<span obOptionLabelIcon [iconName]="option['iconName'] || ''" [iconPosition]="optionIconPosition">
					<span
						[innerHTML]="
							displayWith()(option.label)
								| obHighlightTextPipe: (searchText$ | async) : highlightCssClass : filterRegexFlag
						"
					></span>
				</span>
			</mat-option>
		}
	</ng-template>
	@if (noResultKey?.length > 0) {
		@if ((filteredOptions$ | async)?.length === 0) {
			<mat-option>{{ noResultKey | translate }}</mat-option>
		}
	}
</mat-autocomplete>
