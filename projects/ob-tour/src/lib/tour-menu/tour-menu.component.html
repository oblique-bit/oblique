<div class="obt-tutorial">
	<mat-slide-toggle
		(change)="onToggleChange($event)"
		[checked]="showTours()"
		[matTooltip]="`i18n.ob-tour.tour-menu.toggle.tooltip.${showTours() ? 'off' : 'on'}` | translate"
		class="obt-tutorial-toggle"
	>
		{{ "i18n.ob-tour.tour-menu.toggle.label" | translate }}
	</mat-slide-toggle>

	@if (showTours()) {
		<div
			class="obt-notification"
			role="group"
			[attr.aria-label]="'i18n.ob-tour.tour-menu.notification.label' | translate"
			[ngClass]="{
				'obt-badge-left': badgePosition() === 'left',
				'obt-badge-right': badgePosition() === 'right'
			}"
		>
			@for (state of ["new", "inProgress"]; track state) {
				@if ((getTours(state)?.length ?? 0) > 0) {
					<span
						[ngClass]="{
							'obt-badge-in-progress': state === 'inProgress',
							'obt-badge-new': state === 'new'
						}"
						[id]="'obt-badge-' + dasherize(state)"
						[matTooltip]="getTooltipKey(state) | translate: { amount: getTours(state).length }"
						role="status"
					>
						{{ getTours(state).length }}
						<span class="obt-screen-reader-only">
							{{ getScreenReaderKey(state) | translate: { amount: getTours(state).length } }}
						</span>
					</span>
				}
			}

			<button
				#overlayOrigin="cdkOverlayOrigin"
				(click)="togglePopover($event)"
				[attr.aria-expanded]="isOpen()"
				[attr.aria-haspopup]="true"
				[matTooltip]="'i18n.ob-tour.tour-menu.popover.open' | translate"
				aria-describedby="obt-notification-button-label"
				cdkOverlayOrigin
				class="obt-notification-button"
				mat-button
				obButton="secondary"
				type="button"
			>
				<span id="obt-notification-button-label">
					<span>{{ customButtonLabel() || ("i18n.ob-tour.tour-menu.list.title.dialog" | translate) }}</span>
					<span class="obt-screen-reader-only">
						:{{ "i18n.ob-tour.tour-menu.button.badge.new" | translate: { amount: newTours().length } }},
						{{ "i18n.ob-tour.tour-menu.button.badge.in-progress" | translate: { amount: inProgressTours().length } }}
					</span>
				</span>

				<mat-icon svgIcon="book">
					<span class="obt-screen-reader-only">
						{{ "i18n.ob-tour.tour-menu.popover.icon.book" | translate }}
					</span>
				</mat-icon>
			</button>
		</div>
		<ng-template
			(backdropClick)="closePopover()"
			(overlayOutsideClick)="closePopover()"
			[cdkConnectedOverlayHasBackdrop]="true"
			[cdkConnectedOverlayOpen]="isOpen()"
			[cdkConnectedOverlayOrigin]="overlayOrigin"
			[cdkConnectedOverlayPositions]="menuPositions()"
			cdkConnectedOverlay
		>
			<obt-tour-popover
				(closeEmitter)="closePopover()"
				[doneTours]="doneTours()"
				[inProgressTours]="inProgressTours()"
				[isOpen]="isOpen()"
				[newTours]="newTours()"
			/>
		</ng-template>
	}
</div>
