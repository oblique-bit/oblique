<div class="obt-tutorial">
	<mat-slide-toggle
		(change)="onToggleChange($event)"
		[checked]="showTourMenu"
		[matTooltip]="`i18n.ob-tour.tour-menu.toggle.tooltip.${showTourMenu ? 'off' : 'on'}` | translate"
		class="obt-tutorial-toggle"
	>
		{{ "i18n.ob-tour.tour-menu.toggle.label" | translate }}
	</mat-slide-toggle>

	@if (showTourMenu) {
		<div
			class="obt-notification"
			role="group"
			[attr.aria-label]="'i18n.ob-tour.tour-menu.notification.label' | translate"
			[ngClass]="{
				'obt-badge-left': badgePosition() === 'left',
				'obt-badge-right': badgePosition() === 'right'
			}"
		>
			@for (state of BADGE_TYPES; track state) {
				@if (getBadgeCounter(state) > 0 && isOpen() === false) {
					<span
						[ngClass]="{
							'obt-badge-in-progress': state === 'inProgress',
							'obt-badge-new': state === 'new'
						}"
						[id]="'obt-badge-' + dasherizeBadgeState(state)"
						[matTooltip]="getTooltipKey(state) | translate: { amount: getBadgeCounter(state) }"
						role="status"
					>
						{{ getBadgeCounter(state) }}
						<span class="obt-screen-reader-only">
							{{ getScreenReaderBadgeKey(state) | translate: { amount: getBadgeCounter(state) } }}
						</span>
					</span>
				}
			}

			<button
				#overlayOrigin="cdkOverlayOrigin"
				(click)="togglePopover($event)"
				[attr.aria-expanded]="isOpen()"
				[attr.aria-haspopup]="true"
				[matTooltip]="
					'i18n.ob-tour.tour-menu.popover.open'
						| translate: { buttonLabel: customButtonLabel() || ('i18n.ob-tour.tour-menu.list.title.dialog' | translate) }
				"
				aria-describedby="obt-notification-button-label"
				cdkOverlayOrigin
				class="obt-notification-button"
				mat-button
				obButton="secondary"
				type="button"
			>
				<span id="obt-notification-button-label">
					<span>{{ customButtonLabel() || ("i18n.ob-tour.tour-menu.list.title.dialog" | translate) }}</span>
					<span class="obt-screen-reader-only">
						:{{ "i18n.ob-tour.tour-menu.button.badge.new" | translate: { amount: newTours()?.length } }},
						{{ "i18n.ob-tour.tour-menu.button.badge.in-progress" | translate: { amount: inProgressTours()?.length } }}
					</span>
				</span>

				<mat-icon svgIcon="book">
					<span class="obt-screen-reader-only">
						{{ "i18n.ob-tour.tour-menu.popover.icon.book" | translate }}
					</span>
				</mat-icon>
			</button>
		</div>
		<ng-template
			(backdropClick)="closePopover()"
			(overlayOutsideClick)="closePopover()"
			[cdkConnectedOverlayHasBackdrop]="true"
			[cdkConnectedOverlayOpen]="isOpen()"
			[cdkConnectedOverlayOrigin]="overlayOrigin"
			[cdkConnectedOverlayPositions]="menuPositions()"
			cdkConnectedOverlay
		>
			<obt-tour-popover
				[doneTours]="doneTours()"
				[skippedTours]="skippedTours()"
				[inProgressTours]="inProgressTours()"
				[isOpen]="isOpen()"
				[newTours]="newTours()"
				(closed)="closePopover()"
				(tourStatusChanged)="tourStatusChanged.emit($event)"
				(cleared)="clear()"
			/>
		</ng-template>
	}
</div>
